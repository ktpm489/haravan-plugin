<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <link rel="stylesheet" href="https://raw.githack.com/ktpm489/haravan-plugin/demoV7/contain/css/index.css">
</head>

<body>
  <button class="open-button" onclick="openForm()">Phân tích vấn đề da mặt</button>

  <div class="form-popup" id="myForm">
    <div class="picture-container" id="pictuer-id">
    <p class="file">
      <input type="file" name="file" id="inputImage" />
      <label for="inputImage">Chọn ảnh</label>
    </p>
      <button type="button" class="btn cancel custom" onclick="dislayCamera()" id="cameraBtn">Chụp Ảnh</button>
    </div>
    <div class="contentarea" id="cameraForm">
      <div class="camera">
        <video id="video">Video stream not available.</video>
      </div>
      <div><button id="startbutton">Chụp</button></div>
      <canvas id="canvas"></canvas>
    </div>
    <form action="/" class="form-container" id="subform">
      <img src="https://i.ibb.co/P4pwftk/skin.png" alt="W3Schools.com" id="imageShow">
      <img src="" id="output">
      <button type="button" class="btn upload" onclick="openResult()" id="uploadbtn">Tải lên</button>
      <button type="button" class="btn cancel" onclick="closeForm()">Đóng</button>
    </form>
    <div id="c-placeholder" class="c-placeholder-container"></div>
  </div>
  

  <script>
    function openForm() {
      document.getElementById("myForm").style.display = "block";
    }

    function closeForm() {
      resetFistPageData(false)
    }

    function openResult () {
      document.getElementById("uploadbtn").innerHTML = "Tải lên...";
      uploadImage()
      
    }
  </script>
  <script type="text/javascript">

    function enableBtn() {
      document.getElementById("uploadbtn").disabled = false;
      document.getElementById("uploadbtn").style.opacity = 1;
    }

    function disableBtn() {
      document.getElementById("uploadbtn").disabled = true;
      document.getElementById("uploadbtn").style.opacity = 0.5;
    }

    function includeChooseFileListen() {
      var fileToRead = document.getElementById("inputImage");
      fileToRead.addEventListener(
        "change",
        function (event) {
          // console.log('11111')
          document.getElementById("subform").style.display = "flex";
          document.getElementById("cameraForm").style.display = "none";
          var files = fileToRead.files;
          if (files.length) {
            var img = document.getElementById("imageShow");
            var reader = new FileReader();
            reader.onloadend = function () {
              img.src = reader.result;
            };
            reader.readAsDataURL(files[0]);
            resizeImage(files[0]);
            enableBtn();
          }
        },
        false
      );
    }
    function resizeImage(fileInput) {
      var file = fileInput;
      if (file) {

        var reader = new FileReader();
        // Set the image once loaded into file reader
        reader.onload = function (e) {

          var img = document.createElement("img");
          img.src = e.target.result;

          var canvas = document.createElement("canvas");
          var ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0);

          var MAX_WIDTH = 400;
          var MAX_HEIGHT = 400;
          var width = img.width;
          var height = img.height;
          if (width > height) {
            if (width > MAX_WIDTH) {
              height *= MAX_WIDTH / width;
              width = MAX_WIDTH;
            }
          } else {
            if (height > MAX_HEIGHT) {
              width *= MAX_HEIGHT / height;
              height = MAX_HEIGHT;
            }
          }
          canvas.width = 500;
          canvas.height = 500;
          var ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0, 500, 500);
          dataurl = canvas.toDataURL(file.type);
          document.getElementById("output").src = dataurl;
        }
        reader.readAsDataURL(file);

      }
    }

    
    
</script>
  <script>
    $(function () {
      $("#c-placeholder").load("https://raw.githack.com/ktpm489/haravan-plugin/demoV7/contain/result.html");
    });

    $(function () {
      if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
        document.getElementById("cameraBtn").style.display = "none";
    } else {
      // console.log("fff")
    }
    });

    $(function () {
      includeChooseFileListen();
       disableBtn();
    });

  </script>

</body>

</html>